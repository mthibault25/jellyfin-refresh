<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Riven Media UI</title>
  <link rel="stylesheet" href="{{ url_for('static_files', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>Riven Media ‚Äî Remote UI</h1>
    <nav>
      <a href="{{ url_for('index') }}">Home</a>
    </nav>
    <button id="theme-toggle" class="theme-toggle">üåô</button>
  </header>

  <main>
    {% block content %}{% endblock %}
  </main>

  <footer>
    <small>Runs on {{ request.host }} ‚Äî uses server scripts in /opt/docker/scripts</small>
  </footer>

  <script>
  function toggleTheme() {
    const current = document.documentElement.getAttribute("data-theme");
    const next = current === "dark" ? "light" : "dark";
    document.documentElement.setAttribute("data-theme", next);
  }

  //
  // DARK MODE TOGGLE LOGIC
  //
  const root = document.documentElement;
  const toggleBtn = document.getElementById("theme-toggle");

  // Load saved theme or system preference
  const saved = localStorage.getItem("theme");
  if (saved) {
    root.setAttribute("data-theme", saved);
    toggleBtn.textContent = saved === "dark" ? "‚òÄÔ∏è" : "üåô";
  } else {
    // match OS
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const theme = prefersDark ? "dark" : "light";
    root.setAttribute("data-theme", theme);
    toggleBtn.textContent = prefersDark ? "‚òÄÔ∏è" : "üåô";
  }

  toggleBtn.addEventListener("click", () => {
    const current = root.getAttribute("data-theme");
    const next = current === "dark" ? "light" : "dark";
    root.setAttribute("data-theme", next);
    localStorage.setItem("theme", next);
    toggleBtn.textContent = next === "dark" ? "‚òÄÔ∏è" : "üåô";
  });

  // helper: stream command output and display inside a <pre> element
  async function streamToPre(url, form=null, preId='output') {
    const pre = document.getElementById(preId)
    pre.textContent = ''
    const options = { method: 'POST' }
    if (form) {
      options.body = new URLSearchParams(form)
      options.headers = { 'Content-Type': 'application/x-www-form-urlencoded' }
    }

    const resp = await fetch(url, options)
    if (!resp.ok) {
      pre.textContent = `Error: ${resp.status} ${resp.statusText}`
      return
    }

    if (!resp.body) {
      pre.textContent = await resp.text()
      return
    }

    const reader = resp.body.getReader()
    const decoder = new TextDecoder()
    try {
      while (true) {
        const {done, value} = await reader.read()
        if (done) break
        // decode streamed chunk and append
        pre.textContent += decoder.decode(value, { stream: true })
        pre.scrollTop = pre.scrollHeight
      }
      // flush any remaining partial characters
      pre.textContent += decoder.decode()
      pre.scrollTop = pre.scrollHeight
    } catch (err) {
      pre.textContent += `\n\n[stream error] ${err}`
    } finally {
      if (reader.releaseLock) try { reader.releaseLock() } catch(e) {}
    }
  }
  </script>
  <style>
  /* ---------- DARK MODE ---------- */
  html[data-theme="dark"] body {
    background: #111214;
    color: #e5e7eb;
  }

  /* cards / sections */
  html[data-theme="dark"] .card,
  html[data-theme="dark"] .season {
    background: #1b1c1f;
    color: #e5e7eb;
    box-shadow: 0 1px 4px rgba(0,0,0,0.4);
  }

  /* autocomplete */
  html[data-theme="dark"] .suggestions {
    background: #1b1c1f;
    border-color: #333;
  }
  html[data-theme="dark"] .suggestion-item {
    color: #fff;
  }
  html[data-theme="dark"] .suggestion-item:hover {
    background: #2a2c31;
  }

  /* labels */
  html[data-theme="dark"] label {
    color: #ddd;
  }

  /* search input */
  html[data-theme="dark"] input {
    background: #222;
    color: #eee;
    border: 1px solid #444;
  }

  /* buttons */
  html[data-theme="dark"] button {
    background: #2563eb;
    color: #fff;
  }

  /* output terminal */
  html[data-theme="dark"] .output {
    background: #000;
    color: #0f0;
  }

  /* link colors */
  html[data-theme="dark"] a {
    color: #60a5fa;
  }

  /* resolution colors */
  html[data-theme="dark"] .ep-4k { color: #22c55e; }
  html[data-theme="dark"] .ep-1080 { color: #60a5fa; }
  html[data-theme="dark"] .ep-720 { color: #facc15; }

  /* toggle button */
  .theme-toggle {
    background: transparent;
    border: none;
    font-size: 20px;
    cursor: pointer;
    margin-left: auto;
  }
  .theme-toggle:hover {
    opacity: 0.8;
  }
  </style>

</body>
</html>
